<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decision Tree Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #000000;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Subtle grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 1;
            pointer-events: none;
            z-index: 0;
        }

        .background-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a1a1a 0%, #000000 50%);
            z-index: 0;
        }

        /* Starfield effect */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle linear infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.8); }
            50% { opacity: var(--max-opacity, 0.6); transform: scale(1); }
        }

        /* Shooting stars */
        .shooting-star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 4px 2px rgba(255, 255, 255, 0.5);
            opacity: 0;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes shoot {
            0% {
                opacity: 1;
                transform: translateX(0) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-300px) translateY(300px);
            }
        }

        .shooting-star.active {
            animation: shoot 1.5s ease-out forwards;
        }

        /* Ambient lights */
        .ambient-light {
            position: fixed;
            width: 800px;
            height: 800px;
            border-radius: 50%;
            filter: blur(150px);
            opacity: 0;
            pointer-events: none;
            z-index: 1;
            animation: fadeIn 2s ease-out forwards;
        }

        .light-1 {
            background: radial-gradient(circle, rgba(120, 119, 198, 0.15) 0%, transparent 70%);
            top: -400px;
            left: 50%;
            transform: translateX(-50%);
            animation: ambientFloat 20s ease-in-out infinite, fadeIn 2s ease-out forwards;
        }

        .light-2 {
            background: radial-gradient(circle, rgba(200, 100, 255, 0.1) 0%, transparent 70%);
            bottom: -400px;
            right: 10%;
            animation: ambientFloat 25s ease-in-out infinite reverse, fadeIn 2s ease-out 0.5s forwards;
        }

        @keyframes ambientFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(100px, -50px) scale(1.1); }
            66% { transform: translate(-50px, 100px) scale(0.9); }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 40px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Header section */
        .header {
            text-align: center;
            margin-bottom: 60px;
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.3s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            font-size: 4em;
            font-weight: 600;
            letter-spacing: -2px;
            margin-bottom: 16px;
            background: linear-gradient(180deg, #ffffff 0%, #a0a0a0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .header p {
            font-size: 1.3em;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
            letter-spacing: 0.3px;
            line-height: 1.5;
        }

        /* Analysis display */
        .analysis-display {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 32px;
            padding: 50px;
            box-shadow: 0 20px 80px rgba(0, 0, 0, 0.5);
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.6s forwards;
            position: relative;
            overflow: hidden;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Magical glow effect */
        .analysis-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0.5;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 40px;
            opacity: 0.6;
            transition: opacity 0.5s ease;
        }

        .empty-state.hidden {
            display: none;
        }

        .empty-state-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            stroke: rgba(255, 255, 255, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .empty-state h2 {
            font-size: 1.8em;
            margin-bottom: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .empty-state p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.05em;
            line-height: 1.6;
        }

        /* Magical loading state */
        .loading-state {
            display: none;
            text-align: center;
            padding: 60px 40px;
            position: relative;
        }

        .loading-state.active {
            display: block;
        }

        /* Magical orb */
        .magic-orb {
            width: 120px;
            height: 120px;
            margin: 0 auto 40px;
            position: relative;
        }

        .orb-core {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(200, 150, 255, 0.7), rgba(120, 80, 255, 0.4));
            box-shadow: 
                0 0 40px rgba(150, 100, 255, 0.7),
                0 0 80px rgba(150, 100, 255, 0.5),
                inset 0 0 40px rgba(200, 150, 255, 0.4);
            animation: orbPulse 3s ease-in-out infinite;
            opacity: 1;
        }

        @keyframes orbPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 
                    0 0 40px rgba(150, 100, 255, 0.7),
                    0 0 80px rgba(150, 100, 255, 0.5),
                    inset 0 0 40px rgba(200, 150, 255, 0.4);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 
                    0 0 50px rgba(150, 100, 255, 0.8),
                    0 0 100px rgba(150, 100, 255, 0.6),
                    inset 0 0 50px rgba(200, 150, 255, 0.5);
            }
        }

        /* Magical particles */
        .magic-particles {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            transform: translate(-50%, -50%);
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(200, 150, 255, 0.8);
            border-radius: 50%;
            filter: blur(1px);
        }

        .particle:nth-child(1) {
            top: 20%;
            left: 50%;
            animation: particleFloat1 3s ease-in-out infinite;
        }

        .particle:nth-child(2) {
            top: 50%;
            left: 80%;
            animation: particleFloat2 3.5s ease-in-out infinite 0.5s;
        }

        .particle:nth-child(3) {
            top: 80%;
            left: 50%;
            animation: particleFloat1 4s ease-in-out infinite 1s;
        }

        .particle:nth-child(4) {
            top: 50%;
            left: 20%;
            animation: particleFloat2 3.2s ease-in-out infinite 1.5s;
        }

        .particle:nth-child(5) {
            top: 35%;
            left: 30%;
            animation: particleFloat1 3.8s ease-in-out infinite 0.8s;
        }

        .particle:nth-child(6) {
            top: 65%;
            left: 70%;
            animation: particleFloat2 3.3s ease-in-out infinite 1.2s;
        }

        @keyframes particleFloat1 {
            0% { transform: translate(0, 0) scale(1); opacity: 0; }
            10% { opacity: 0.8; }
            50% { opacity: 0.9; }
            90% { opacity: 0.8; }
            100% { transform: translate(0, -60px) scale(0.5); opacity: 0; }
        }

        @keyframes particleFloat2 {
            0% { transform: translate(0, 0) scale(1); opacity: 0; }
            10% { opacity: 0.8; }
            50% { opacity: 0.9; }
            90% { opacity: 0.8; }
            100% { transform: translate(0, 60px) scale(0.5); opacity: 0; }
        }

        /* Glow rings */
        .glow-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 1.5px solid rgba(200, 150, 255, 0.4);
            border-radius: 50%;
            animation: ringExpand 4s ease-out infinite;
        }

        .glow-ring:nth-child(1) {
            width: 120px;
            height: 120px;
            animation-delay: 0s;
        }

        .glow-ring:nth-child(2) {
            width: 120px;
            height: 120px;
            animation-delay: 1.3s;
        }

        .glow-ring:nth-child(3) {
            width: 120px;
            height: 120px;
            animation-delay: 2.6s;
        }

        @keyframes ringExpand {
            0% {
                width: 120px;
                height: 120px;
                opacity: 0.8;
                border-color: rgba(200, 150, 255, 0.4);
            }
            50% {
                opacity: 0.5;
            }
            100% {
                width: 280px;
                height: 280px;
                opacity: 0;
                border-color: rgba(200, 150, 255, 0.1);
            }
        }

        .loading-text {
            font-size: 1.3em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-top: 80px;
            animation: textPulse 2.5s ease-in-out infinite;
        }

        @keyframes textPulse {
            0%, 100% { opacity: 0.85; }
            50% { opacity: 1; }
        }

        .loading-subtext {
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 8px;
            animation: subtextPulse 2.5s ease-in-out infinite;
            animation-delay: 0.3s;
        }

        @keyframes subtextPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.7; }
        }

        /* Result display */
        .result-display {
            display: none;
            width: 100%;
            opacity: 0;
            animation: fadeInScale 0.8s ease-out forwards;
        }

        .result-display.active {
            display: block;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .result-image {
            width: 100%;
            border-radius: 20px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .result-analysis {
            text-align: left;
        }

        .analysis-label {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .analysis-content {
            font-size: 1.05em;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.85);
        }

        .analysis-content strong {
            color: rgba(255, 255, 255, 1);
            font-weight: 600;
        }

        .analysis-content em {
            color: rgba(200, 150, 255, 0.9);
            font-style: normal;
        }

        /* Error message */
        .error-message {
            background: rgba(255, 100, 100, 0.1);
            border: 1px solid rgba(255, 100, 100, 0.3);
            padding: 20px 24px;
            border-radius: 16px;
            font-size: 1em;
            color: rgba(255, 150, 150, 0.9);
            line-height: 1.6;
            text-align: center;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Info button */
        .info-button {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            opacity: 0;
            transform: scale(0.8);
        }

        .info-button.visible {
            opacity: 1;
            transform: scale(1);
            animation: pulseInfo 2s ease-in-out infinite;
        }

        @keyframes pulseInfo {
            0%, 100% { box-shadow: 0 0 20px rgba(200, 150, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(200, 150, 255, 0.5); }
        }

        .info-button:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .info-button svg {
            width: 28px;
            height: 28px;
            stroke: rgba(255, 255, 255, 0.9);
        }

        /* Graph button */
        .graph-button {
            position: fixed;
            bottom: 40px;
            right: 120px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            opacity: 0;
            transform: scale(0.8);
        }

        .graph-button.visible {
            opacity: 1;
            transform: scale(1);
            animation: pulseGraph 2s ease-in-out infinite;
        }

        @keyframes pulseGraph {
            0%, 100% { box-shadow: 0 0 20px rgba(150, 200, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(150, 200, 255, 0.5); }
        }

        .graph-button:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .graph-button svg {
            width: 28px;
            height: 28px;
            stroke: rgba(255, 255, 255, 0.9);
        }

        /* Graph fullscreen modal */
        .graph-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .graph-modal.active {
            display: flex;
            opacity: 1;
        }

        .graph-modal-content {
            position: relative;
            max-width: 95vw;
            max-height: 95vh;
            animation: zoomIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .graph-modal-content img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .graph-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2001;
        }

        .graph-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .graph-modal-close svg {
            width: 24px;
            height: 24px;
            stroke: white;
        }

        /* Feature importance modal */
        .feature-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-modal.active {
            display: flex;
            opacity: 1;
        }

        .feature-modal-content {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: rotate(90deg);
        }

        .modal-close svg {
            width: 20px;
            height: 20px;
            stroke: rgba(255, 255, 255, 0.9);
        }

        .modal-title {
            font-size: 2em;
            font-weight: 600;
            margin-bottom: 10px;
            background: linear-gradient(180deg, #ffffff 0%, #a0a0a0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-subtitle {
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 30px;
        }

        .feature-chart {
            margin-top: 20px;
        }

        .feature-bar {
            margin-bottom: 20px;
            opacity: 0;
            animation: barSlideIn 0.5s ease-out forwards;
        }

        .feature-bar:nth-child(1) { animation-delay: 0.1s; }
        .feature-bar:nth-child(2) { animation-delay: 0.15s; }
        .feature-bar:nth-child(3) { animation-delay: 0.2s; }
        .feature-bar:nth-child(4) { animation-delay: 0.25s; }
        .feature-bar:nth-child(5) { animation-delay: 0.3s; }
        .feature-bar:nth-child(6) { animation-delay: 0.35s; }
        .feature-bar:nth-child(7) { animation-delay: 0.4s; }
        .feature-bar:nth-child(8) { animation-delay: 0.45s; }
        .feature-bar:nth-child(9) { animation-delay: 0.5s; }
        .feature-bar:nth-child(10) { animation-delay: 0.55s; }

        @keyframes barSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .feature-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .feature-name {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95em;
        }

        .feature-value {
            font-weight: 600;
            font-size: 1em;
            font-family: monospace;
        }

        .feature-value.positive {
            color: #ff6b6b;
        }

        .feature-value.negative {
            color: #4facfe;
        }

        .feature-bar-container {
            position: relative;
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            overflow: hidden;
        }

        .feature-bar-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: absolute;
            top: 0;
        }

        .feature-bar-fill.positive {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.6), rgba(255, 107, 107, 0.9));
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.4);
        }

        .feature-bar-fill.negative {
            background: linear-gradient(90deg, rgba(79, 172, 254, 0.6), rgba(79, 172, 254, 0.9));
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.4);
        }

        .feature-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmerBar 2s infinite;
        }

        @keyframes shimmerBar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .baseline {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 1;
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
            }

            .header h1 {
                font-size: 2.5em;
            }

            .header p {
                font-size: 1.1em;
            }

            .analysis-display {
                padding: 30px 24px;
                min-height: 400px;
            }

            .magic-orb {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="background-gradient"></div>
    
    <!-- Starfield -->
    <div class="stars" id="starfield"></div>
    
    <!-- Shooting stars -->
    <div class="shooting-star" id="shootingStar1"></div>
    <div class="shooting-star" id="shootingStar2"></div>
    <div class="shooting-star" id="shootingStar3"></div>
    <div class="shooting-star" id="shootingStar4"></div>
    <div class="shooting-star" id="shootingStar5"></div>
    <div class="shooting-star" id="shootingStar6"></div>
    
    <div class="ambient-light light-1"></div>
    <div class="ambient-light light-2"></div>

    <div class="container">
        <div class="header">
            <h1>Prediction Analysis Intelligence</h1>
        </div>

        <div class="analysis-display" id="analysisDisplay">
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 8v4m0 4h.01"></path>
                </svg>
                <h2>Awaiting Analysis</h2>
                <p>The system is ready to process your prediction results</p>
            </div>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <div class="magic-orb">
                    <div class="magic-particles">
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                    </div>
                    <div class="glow-ring"></div>
                    <div class="glow-ring"></div>
                    <div class="glow-ring"></div>
                    <div class="orb-core"></div>
                </div>
                <div class="loading-text">Analyzing Prediction</div>
                <div class="loading-subtext">Processing probabilities and feature importance...</div>
            </div>

            <!-- Result Display -->
            <div class="result-display" id="resultDisplay">
                <img class="result-image" id="resultImage" src="" alt="Prediction Analysis">
                <div class="result-analysis">
                    <div class="analysis-content" id="analysisContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Button -->
    <div class="info-button" id="infoButton">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
    </div>

    <!-- Graph Button -->
    <div class="graph-button" id="graphButton">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"></line>
            <line x1="12" y1="20" x2="12" y2="4"></line>
            <line x1="6" y1="20" x2="6" y2="14"></line>
        </svg>
    </div>

    <!-- Graph Fullscreen Modal -->
    <div class="graph-modal" id="graphModal">
        <div class="graph-modal-close" id="graphModalClose">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </div>
        <div class="graph-modal-content">
            <img src="age_group_churn_analysis.png" alt="Age Group Churn Analysis">
        </div>
    </div>

    <!-- Feature Importance Modal -->
    <div class="feature-modal" id="featureModal">
        <div class="feature-modal-content">
            <div class="modal-close" id="modalClose">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </div>
            <h2 class="modal-title">Feature Importance</h2>

            <div class="feature-chart" id="featureChart"></div>
        </div>
    </div>

    <script>
        // ⚠️ HARDCODED API KEY
        const apiKey = 'AIzaSyBphaPw_Sl56pEq7EzuOEPLN0sir6YBkFU';

        // State
        let currentImage = null;
        let currentFeatureImportances = null;

        // DOM elements - will be initialized after DOM loads
        let emptyState, loadingState, resultDisplay, resultImage, analysisContent;
        let infoButton, featureModal, modalClose, featureChart;
        let graphButton, graphModal, graphModalClose;

        // Initialize DOM elements
        function initDOMElements() {
            emptyState = document.getElementById('emptyState');
            loadingState = document.getElementById('loadingState');
            resultDisplay = document.getElementById('resultDisplay');
            resultImage = document.getElementById('resultImage');
            analysisContent = document.getElementById('analysisContent');
            infoButton = document.getElementById('infoButton');
            featureModal = document.getElementById('featureModal');
            modalClose = document.getElementById('modalClose');
            featureChart = document.getElementById('featureChart');
            graphButton = document.getElementById('graphButton');
            graphModal = document.getElementById('graphModal');
            graphModalClose = document.getElementById('graphModalClose');

            // Set up modal event listeners
            if (infoButton) {
                console.log('Info button found, attaching click listener');
                infoButton.addEventListener('click', () => {
                    console.log('Info button clicked!');
                    console.log('Current feature importances:', currentFeatureImportances);
                    if (currentFeatureImportances) {
                        displayFeatureImportances(currentFeatureImportances);
                        featureModal.classList.add('active');
                        console.log('Modal should be open now');
                    } else {
                        console.log('No feature importances available');
                    }
                });
            } else {
                console.log('Info button NOT found in DOM!');
            }

            if (modalClose) {
                modalClose.addEventListener('click', () => {
                    featureModal.classList.remove('active');
                });
            }

            if (featureModal) {
                featureModal.addEventListener('click', (e) => {
                    if (e.target === featureModal) {
                        featureModal.classList.remove('active');
                    }
                });
            }

            // Graph button event listeners
            if (graphButton) {
                console.log('Graph button found, attaching click listener');
                graphButton.addEventListener('click', () => {
                    console.log('Graph button clicked!');
                    graphModal.classList.add('active');
                });
            } else {
                console.log('Graph button NOT found in DOM!');
            }

            if (graphModalClose) {
                graphModalClose.addEventListener('click', () => {
                    graphModal.classList.remove('active');
                });
            }

            if (graphModal) {
                graphModal.addEventListener('click', (e) => {
                    if (e.target === graphModal) {
                        graphModal.classList.remove('active');
                    }
                });
            }
        }

        // Show empty state
        function showEmptyState() {
            emptyState.classList.remove('hidden');
            loadingState.classList.remove('active');
            resultDisplay.classList.remove('active');
        }

        // Show loading state
        function showLoading() {
            emptyState.classList.add('hidden');
            loadingState.classList.add('active');
            resultDisplay.classList.remove('active');
        }

        // Show result
        function showResult(imageUrl, analysisText) {
            emptyState.classList.add('hidden');
            loadingState.classList.remove('active');
            
            resultImage.src = imageUrl;
            analysisContent.innerHTML = formatResponse(analysisText);
            
            resultDisplay.classList.add('active');
        }

        // Show error
        function showError(message) {
            emptyState.classList.add('hidden');
            loadingState.classList.remove('active');
            resultDisplay.classList.remove('active');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            const display = document.getElementById('analysisDisplay');
            display.innerHTML = '';
            display.appendChild(errorDiv);
            
            setTimeout(() => {
                display.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 8v4m0 4h.01"></path>
                        </svg>
                        <h2>Awaiting Analysis</h2>
                        <p>The system is ready to process your prediction results</p>
                    </div>
                    <div class="loading-state" id="loadingState">
                        <div class="magic-orb">
                            <div class="magic-particles">
                                <div class="particle"></div>
                                <div class="particle"></div>
                                <div class="particle"></div>
                                <div class="particle"></div>
                                <div class="particle"></div>
                                <div class="particle"></div>
                            </div>
                            <div class="glow-ring"></div>
                            <div class="glow-ring"></div>
                            <div class="glow-ring"></div>
                            <div class="orb-core"></div>
                        </div>
                        <div class="loading-text">Analyzing Prediction</div>
                        <div class="loading-subtext">Processing probabilities and feature importance...</div>
                    </div>
                    <div class="result-display" id="resultDisplay">
                        <img class="result-image" id="resultImage" src="" alt="Prediction Analysis">
                        <div class="result-analysis">
                            <div class="analysis-label">AI Analysis</div>
                            <div class="analysis-content" id="analysisContent"></div>
                        </div>
                    </div>
                `;
                initElements();
                initDOMElements();
            }, 5000);
        }

        function initElements() {
            emptyState = document.getElementById('emptyState');
            loadingState = document.getElementById('loadingState');
            resultDisplay = document.getElementById('resultDisplay');
            resultImage = document.getElementById('resultImage');
            analysisContent = document.getElementById('analysisContent');
            infoButton = document.getElementById('infoButton');
            featureModal = document.getElementById('featureModal');
            modalClose = document.getElementById('modalClose');
            featureChart = document.getElementById('featureChart');
        }

        // Analyze image with Gemini
        async function analyzeImage(imageDataUrl) {
            currentImage = imageDataUrl;
            showLoading();

            try {
                // Extract MIME type and base64 data
                const matches = imageDataUrl.match(/^data:([^;]+);base64,(.+)$/);
                if (!matches) {
                    showError('Invalid image format. Please provide a valid base64 image.');
                    return;
                }
                
                const mimeType = matches[1];
                const base64Image = matches[2];
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: `SYSTEM INSTRUCTION: We are performing the task of insurance churn prediction.The input features provided to the machine learning model are: {}The model outputs a churn probability of {}The feature importance values (indicating how much each feature influenced the prediction) are: {}Your task is to explain the churn probability in simple, non-technical language using exactly three sentences.The explanation should:Clearly describe why the model predicted this churn probability, referring to the most important features.Be intuitive, human-like, and easy for a non-technical person to understand.Contain only the three explanatory sentences — no pretext, posttext, or additional commentary.`
                                },
                                {
                                    inline_data: {
                                        mime_type: mimeType,
                                        data: base64Image
                                    }
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();

                if (data.error) {
                    showError(`Error: ${data.error.message}`);
                    return;
                }

                if (data.candidates && data.candidates[0]) {
                    const text = data.candidates[0].content.parts[0].text;
                    
                    // Check if it's an error response
                    if (text.includes('ERROR:')) {
                        showError(text);
                    } else {
                        showResult(imageDataUrl, text);
                    }
                } else {
                    showError('Unable to analyze the image. Please try again.');
                }
            } catch (error) {
                showError(`Error: ${error.message}`);
            }
        }

        // Format response with basic markdown
        function formatResponse(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');
        }

        // Expose function globally for ML model integration
        window.analyzeDecisionTree = analyzeImage;
        window.analyzePrediction = analyzeImage;

        // Create starfield
        function createStarfield() {
            const starfield = document.getElementById('starfield');
            const numberOfStars = 100;
            
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // Random position
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                
                // Random size (1-3px)
                const size = Math.random() * 2 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                
                // Random animation duration (2-5s)
                const duration = Math.random() * 3 + 2;
                star.style.animationDuration = duration + 's';
                
                // Random delay
                const delay = Math.random() * 5;
                star.style.animationDelay = delay + 's';
                
                // Random opacity range
                const maxOpacity = Math.random() * 0.4 + 0.3; // 0.3 to 0.7
                star.style.setProperty('--max-opacity', maxOpacity);
                
                starfield.appendChild(star);
            }
        }

        // Create shooting stars effect
        function createShootingStar(starId) {
            const star = document.getElementById(starId);
            
            // Random starting position (top half of screen, right side)
            star.style.left = (Math.random() * 30 + 70) + '%';
            star.style.top = (Math.random() * 40) + '%';
            
            // Trigger animation
            star.classList.add('active');
            
            // Remove class after animation
            setTimeout(() => {
                star.classList.remove('active');
            }, 1500);
        }

        // Shooting stars at random intervals
        function startShootingStars() {
            const shootingStarIds = ['shootingStar1', 'shootingStar2', 'shootingStar3', 'shootingStar4', 'shootingStar5', 'shootingStar6'];
            
            function randomShootingStar() {
                const randomId = shootingStarIds[Math.floor(Math.random() * shootingStarIds.length)];
                createShootingStar(randomId);
                
                // Next shooting star in 4-8 seconds (more frequent)
                const nextDelay = Math.random() * 4000 + 4000;
                setTimeout(randomShootingStar, nextDelay);
            }
            
            // Start first shooting star after 2 seconds
            setTimeout(randomShootingStar, 2000);
        }

        // Initialize starfield on page load
        createStarfield();
        startShootingStars();

        // Check if there's prediction data from the previous page
        window.addEventListener('DOMContentLoaded', function() {
            // Initialize DOM elements AFTER DOM is ready
            initDOMElements();
            
            const predictionData = sessionStorage.getItem('predictionResult');
            
            if (predictionData) {
                // Clear the session storage
                sessionStorage.removeItem('predictionResult');
                
                // Parse the prediction result
                const result = JSON.parse(predictionData);
                
                // Generate text-based analysis data for Gemini
                analyzePredictionData(result);
            }
        });

        // Function to analyze prediction data (not image)
        async function analyzePredictionData(result) {
            showLoading();

            try {
                // Create a detailed text description of the prediction
                const predictionText = formatPredictionDataForAnalysis(result);
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        systemInstruction: {
                            parts: [{
                                text: `We are performing the task of insurance churn prediction.

The input features provided to the machine learning model are: {}

The model outputs a churn probability of {}

The feature importance values (indicating how much each feature influenced the prediction) are: {}

Your task is to explain the churn probability in simple, non-technical language using exactly three sentences.
The explanation should:

Clearly describe why the model predicted this churn probability, referring to the most important features.

Be intuitive, human-like, and easy for a non-technical person to understand.

Contain only the three explanatory sentences — no pretext, posttext, or additional commentary.
populate the values in the curly braces, also dont use first person language and use the customer instead everywhere
`
                            }]
                        },
                        contents: [{
                            parts: [
                                {
                                    text: `Here is the prediction data to analyze:

${predictionText}`
                                }
                            ]
                        }]
                    })
                });

                const data = await response.json();

                if (data.error) {
                    showError(`Error: ${data.error.message}`);
                    return;
                }

                if (data.candidates && data.candidates[0]) {
                    const text = data.candidates[0].content.parts[0].text;
                    
                    // Check if it's an error response
                    if (text.includes('ERROR:')) {
                        showError(text);
                    } else {
                        // Show result without image
                        showResultWithoutImage(text, result);
                    }
                } else {
                    showError('Unable to analyze the prediction data. Please try again.');
                }
            } catch (error) {
                showError(`Error: ${error.message}`);
            }
        }

        // Format prediction data for Gemini analysis
        function formatPredictionDataForAnalysis(result) {
            let text = `PREDICTION RESULTS:\n\n`;
            
            // Prediction outcome
            text += `Prediction: ${result.prediction === 1 ? 'WILL CHURN' : 'WILL NOT CHURN'}\n`;
            text += `Churn Probability: ${(result.churn_probability * 100).toFixed(2)}%\n`;
            text += `Retention Probability: ${((1 - result.churn_probability) * 100).toFixed(2)}%\n\n`;
            
            // Feature importances
            text += `FEATURE IMPORTANCES:\n`;
            const featureData = result.feature_importances || result.feature_contributions;
            if (featureData) {
                const sortedFeatures = Object.entries(featureData)
                    .sort((a, b) => Math.abs(b[1]) - Math.abs(a[1]));
                
                sortedFeatures.forEach(([feature, importance]) => {
                    const sign = importance >= 0 ? '+' : '';
                    text += `- ${feature}: ${sign}${importance.toFixed(4)}\n`;
                });
            }
            
            text += `\nINPUT FEATURES:\n`;
            const inputData = result.input_data || result.input_features;
            if (inputData) {
                Object.entries(inputData).forEach(([feature, value]) => {
                    text += `- ${feature}: ${value}\n`;
                });
            }
            
            // Add scraper data if available
            if (result.scraper_data) {
                text += `\nEXTERNAL MARKET DATA:\n`;
                
                if (result.scraper_data.chubb_stock) {
                    text += `\nChubb Stock Data:\n`;
                    text += `- Current Price: $${result.scraper_data.chubb_stock.current_price}\n`;
                    text += `- Change: ${result.scraper_data.chubb_stock.change} (${result.scraper_data.chubb_stock.change_percent})\n`;
                }
                
                if (result.scraper_data.chubb_news && result.scraper_data.chubb_news.length > 0) {
                    text += `\nRecent Chubb News Headlines:\n`;
                    result.scraper_data.chubb_news.slice(0, 3).forEach((news, idx) => {
                        text += `${idx + 1}. ${news.title}\n`;
                    });
                }
                
                if (result.scraper_data.competitor_stock) {
                    text += `\nCompetitor Stock Performance:\n`;
                    Object.entries(result.scraper_data.competitor_stock).forEach(([company, data]) => {
                        text += `- ${company}: $${data.price} (${data.change})\n`;
                    });
                }
            }
            
            return text;
        }

        // Show result without image
        function showResultWithoutImage(analysisText, predictionResult) {
            console.log('showResultWithoutImage called with:', predictionResult);
            console.log('Feature importances in result:', predictionResult.feature_importances);
            console.log('Feature contributions in result:', predictionResult.feature_contributions);
            
            emptyState.classList.add('hidden');
            loadingState.classList.remove('active');
            
            // Store feature importances (try both keys for backward compatibility)
            currentFeatureImportances = predictionResult.feature_importances || predictionResult.feature_contributions;
            console.log('Stored feature importances:', currentFeatureImportances);
            
            // Show info button
            console.log('Making info button visible');
            infoButton.classList.add('visible');
            console.log('Info button classes:', infoButton.classList);
            
            // Show graph button
            console.log('Making graph button visible');
            graphButton.classList.add('visible');
            console.log('Graph button classes:', graphButton.classList);
            
            // Create a visual representation card
            const visualCard = createPredictionVisual(predictionResult);
            resultImage.replaceWith(visualCard);
            
            analysisContent.innerHTML = formatResponse(analysisText);
            
            resultDisplay.classList.add('active');
        }

        // Create a visual representation of the prediction
        function createPredictionVisual(result) {
            const card = document.createElement('div');
            card.className = 'result-image';
            card.style.background = 'rgba(255, 255, 255, 0.03)';
            card.style.padding = '40px';
            card.style.display = 'flex';
            card.style.flexDirection = 'column';
            card.style.gap = '30px';
            
            const isChurn = result.prediction === 1;
            const churnProb = (result.churn_probability * 100).toFixed(2);
            const retentionProb = ((1 - result.churn_probability) * 100).toFixed(2);
            
            card.innerHTML = `
                <div style="text-align: center;">
                    <h2 style="font-size: 2em; color: ${isChurn ? '#ff6b6b' : '#ffffff'}; margin-bottom: 20px;">
                        Prediction: ${isChurn ? 'WILL CHURN' : 'WILL NOT CHURN'}
                    </h2>
                    <div style="font-size: 3em; font-weight: 600; color: ${isChurn ? '#ff6b6b' : '#ffffff'};">
                        ${churnProb}%
                    </div>
                    <div style="font-size: 1.2em; color: rgba(255, 255, 255, 0.6); margin-top: 5px;">
                        ${retentionProb}% retention probability
                    </div>
                </div>
            `;
            
            return card;
        }

        // Format top features
        function formatTopFeatures(features) {
            if (!features) return '<p>No feature importance data available</p>';
            
            const sortedFeatures = Object.entries(features)
                .sort((a, b) => Math.abs(b[1]) - Math.abs(a[1]))
                .slice(0, 6);
            
            return sortedFeatures.map(([feature, importance]) => {
                const isPositive = importance >= 0;
                const color = isPositive ? '#ff6b6b' : '#4facfe';
                const icon = isPositive ? '🎯' : '🛡️';
                const label = isPositive ? 'Increases churn risk' : 'Decreases churn risk';
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                        <div style="flex: 1;">
                            <div style="font-weight: 500; color: rgba(255, 255, 255, 0.9);">
                                ${icon} ${feature.replace(/_/g, ' ').toUpperCase()}
                            </div>
                            <div style="font-size: 0.85em; color: rgba(255, 255, 255, 0.5); margin-top: 3px;">
                                ${label}
                            </div>
                        </div>
                        <div style="font-weight: 600; font-size: 1.1em; color: ${color};">
                            ${importance >= 0 ? '+' : ''}${importance.toFixed(4)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Display feature importances in a beautiful SHAP-style chart
        function displayFeatureImportances(importances) {
            if (!importances) {
                featureChart.innerHTML = '<p style="text-align: center; color: rgba(255, 255, 255, 0.5);">No feature importance data available</p>';
                return;
            }

            // Sort by absolute value
            const sortedFeatures = Object.entries(importances)
                .sort((a, b) => Math.abs(b[1]) - Math.abs(a[1]));

            // Find max absolute value for scaling
            const maxAbsValue = Math.max(...sortedFeatures.map(([_, val]) => Math.abs(val)));

            let html = '<div style="position: relative;">';
            
            sortedFeatures.forEach(([feature, value], index) => {
                const isPositive = value >= 0;
                const percentage = (Math.abs(value) / maxAbsValue) * 50; // Scale to 50% max (half the container)
                const formattedValue = (value >= 0 ? '+' : '') + value.toFixed(4);
                const featureName = feature.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                html += `
                    <div class="feature-bar">
                        <div class="feature-label">
                            <span class="feature-name">${index + 1}. ${featureName}</span>
                            <span class="feature-value ${isPositive ? 'positive' : 'negative'}">${formattedValue}</span>
                        </div>
                        <div class="feature-bar-container">
                            <div class="baseline"></div>
                            <div class="feature-bar-fill ${isPositive ? 'positive' : 'negative'}" 
                                 style="${isPositive 
                                    ? `width: ${percentage}%; left: 50%;` 
                                    : `width: ${percentage}%; right: 50%;`}"></div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            featureChart.innerHTML = html;
        }
    </script>
</body>
</html>